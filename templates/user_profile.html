{% extends "base.html" %}

{% block title %}User Profile - Secret Journal Manager{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-user me-2"></i>My Profile</h2>
            {% if current_user.is_admin %}
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-tachometer-alt me-1"></i>Admin Dashboard
            </a>
            {% endif %}
        </div>
        
        <!-- Account Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>Account Information</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Username</label>
                        <div class="form-control-plaintext">{{ current_user.username }}</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email Address</label>
                        <div class="form-control-plaintext">
                            {{ current_user.email }}
                            {% if current_user.email_verified %}
                            <span class="badge bg-success ms-2">Verified</span>
                            {% else %}
                            <span class="badge bg-warning text-dark ms-2">Unverified</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Account Type</label>
                        <div class="form-control-plaintext">
                            {% if current_user.is_admin %}
                            <span class="badge bg-primary">Administrator</span>
                            {% else %}
                            <span class="badge bg-secondary">Standard User</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Account Status</label>
                        <div class="form-control-plaintext">
                            {% if current_user.is_active %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-danger">Disabled</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Member Since</label>
                        <div class="form-control-plaintext">{{ current_user.created_at.strftime('%B %d, %Y') if current_user.created_at else 'N/A' }}</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Last Login</label>
                        <div class="form-control-plaintext">
                            {% if current_user.last_login %}
                            {{ current_user.last_login.strftime('%B %d, %Y at %I:%M %p') }}
                            {% else %}
                            <span class="text-muted">Never</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Security Status -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-shield-alt me-2"></i>Security Status</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="security-check">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Password Protection</span>
                                <span class="badge bg-success">
                                    <i class="fas fa-check"></i> Active
                                </span>
                            </div>
                            <small class="text-muted">Last changed: {{ current_user.password_changed_at.strftime('%Y-%m-%d') if current_user.password_changed_at else 'N/A' }}</small>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="security-check">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Security Questions</span>
                                {% if current_user.security_questions %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check"></i> Configured
                                </span>
                                {% else %}
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-exclamation-triangle"></i> Missing
                                </span>
                                {% endif %}
                            </div>
                            <small class="text-muted">3 personalized questions</small>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="security-check">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Recovery Phrase</span>
                                {% if current_user.recovery_phrase %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check"></i> Generated
                                </span>
                                {% else %}
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-exclamation-triangle"></i> Missing
                                </span>
                                {% endif %}
                            </div>
                            <small class="text-muted">12-word backup phrase</small>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="security-check">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Encryption Keys</span>
                                {% if current_user.user_keys %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check"></i> 5-Key System
                                </span>
                                {% else %}
                                <span class="badge bg-danger">
                                    <i class="fas fa-times"></i> Not Setup
                                </span>
                                {% endif %}
                            </div>
                            <small class="text-muted">Version: {{ current_user.user_keys.key_version if current_user.user_keys else 'N/A' }}</small>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Your Data is Protected</h6>
                        <p class="mb-0">Your secrets are protected by our 5-key encryption system. Even if you forget your password, your data can be recovered using security questions, recovery phrase, admin assistance, or emergency procedures.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Statistics -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-chart-bar me-2"></i>Usage Statistics</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <div class="stat-box">
                            <h3 class="text-primary">{{ current_user.secrets|length }}</h3>
                            <small class="text-muted">Stored Secrets</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-box">
                            <h3 class="text-success">{{ journal_count or 0 }}</h3>
                            <small class="text-muted">Journal Entries</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-box">
                            <h3 class="text-info">{{ shared_count or 0 }}</h3>
                            <small class="text-muted">Shared Secrets</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-tools me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <a href="{{ url_for('secrets') }}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-key me-2"></i>Manage Secrets
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="{{ url_for('journal') }}" class="btn btn-outline-success w-100">
                            <i class="fas fa-calendar-alt me-2"></i>Write Journal
                        </a>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-outline-warning w-100" disabled>
                            <i class="fas fa-cog me-2"></i>Update Recovery Options
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-outline-info w-100" disabled>
                            <i class="fas fa-download me-2"></i>Export Data
                        </button>
                    </div>
                </div>
                
                <hr>
                
                <div class="text-center">
                    <p class="text-muted mb-2"><small>Need help with account recovery?</small></p>
                    <a href="{{ url_for('recovery') }}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-question-circle me-1"></i>Recovery Options
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.security-check {
    padding: 0.75rem;
    border: 1px solid var(--bs-border-color);
    border-radius: 0.375rem;
    background-color: var(--bs-light);
}

.stat-box {
    padding: 1rem;
}

.stat-box h3 {
    margin-bottom: 0.25rem;
}
</style>
{% endblock %}

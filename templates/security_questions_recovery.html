{% extends "base.html" %}

{% block title %}Password Recovery - Security Questions{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header text-center">
                <h4><i class="fas fa-question-circle me-2"></i>Password Recovery - Security Questions</h4>
                <p class="text-muted mb-0">Answer your security questions to reset your password</p>
            </div>
            <div class="card-body">
                {% if not show_questions %}
                    <!-- Step 1: Enter username to load security questions -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Instructions</h6>
                        <p class="mb-0">Enter your username to load your security questions.</p>
                    </div>
                    
                    <form method="POST">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username *</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                            <div class="form-text">Enter your username</div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-search me-2"></i>Load Security Questions
                            </button>
                        </div>
                    </form>
                {% else %}
                    <!-- Step 2: Answer the loaded security questions -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Instructions</h6>
                        <p class="mb-0">Answer all 3 security questions correctly. Answers are not case-sensitive.</p>
                    </div>
                    
                    <form method="POST">
                        <!-- Hidden field to preserve username -->
                        <input type="hidden" name="username" value="{{ username }}">
                        
                        <div class="mb-3">
                            <label class="form-label"><strong>Username:</strong> {{ username }}</label>
                        </div>
                        
                        <div class="mb-4">
                            <label for="answer1" class="form-label">
                                <strong>Question 1:</strong> {{ questions[0] }}
                            </label>
                            <input type="text" class="form-control" id="answer1" name="answer1" required>
                            <div class="form-text">Enter your answer (not case sensitive)</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="answer2" class="form-label">
                                <strong>Question 2:</strong> {{ questions[1] }}
                            </label>
                            <input type="text" class="form-control" id="answer2" name="answer2" required>
                            <div class="form-text">Enter your answer (not case sensitive)</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="answer3" class="form-label">
                                <strong>Question 3:</strong> {{ questions[2] }}
                            </label>
                            <input type="text" class="form-control" id="answer3" name="answer3" required>
                            <div class="form-text">Enter your answer (not case sensitive)</div>
                        </div>
                        
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-shield-alt me-2"></i>Security Notice</h6>
                            <p class="mb-0"><small>If you answer all questions correctly, you'll be able to set a new password. Your encrypted data will remain safe and accessible.</small></p>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-unlock me-2"></i>Verify Answers & Reset Password
                            </button>
                            <a href="{{ url_for('recover_password_with_questions') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Back to Username Entry
                            </a>
                        </div>
                    </form>
                {% endif %}
                
                <hr>
                
                <div class="text-center">
                    <p class="mb-2"><small>Try a different recovery method?</small></p>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('recover_password_with_phrase') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-key me-1"></i>Use Recovery Phrase Instead
                        </a>
                        <a href="{{ url_for('login') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-arrow-left me-1"></i>Back to Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body bg-warning text-dark text-center">
                <h6><i class="fas fa-exclamation-triangle me-2"></i>Having Trouble?</h6>
                <p class="mb-0"><small>Make sure you enter the exact answers you provided during setup. Answers are not case-sensitive, but spelling must be correct.</small></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
